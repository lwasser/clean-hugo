{{/*
  SEO Partial - Open Graph, Canonical URLs, and Article Metadata

  Provides rich metadata for social sharing (LinkedIn, Discord, Slack, Mastodon, Bluesky, etc.)
  and search engines.
*/}}

{{/* Determine page title */}}
{{ $title := .Title }}
{{ if .IsHome }}
  {{ $title = .Site.Title }}
{{ else }}
  {{ $title = printf "%s | %s" .Title .Site.Title }}
{{ end }}

{{/* Determine description */}}
{{ $description := .Description }}
{{ if not $description }}
  {{ if .Summary }}
    {{ $description = .Summary | plainify | truncate 160 }}
  {{ else }}
    {{ $description = .Site.Params.tagline | default .Site.Params.description }}
  {{ end }}
{{ end }}

{{/* Determine image for social sharing */}}
{{ $img := partial "get-image.html" (dict "image" .Params.image "fallbackAlt" .Title) }}
{{ $image := "" }}
{{ $imageAlt := .Title }}
{{ if $img.exists }}
  {{ $image = $img.src | absURL }}
  {{ $imageAlt = $img.alt }}
{{ else if .Site.Params.seo.default_image }}
  {{ $image = .Site.Params.seo.default_image | absURL }}
{{ end }}

{{/* Canonical URL */}}
<link rel="canonical" href="{{ .Permalink }}">

{{/* Open Graph / Social Media Meta Tags */}}
<meta property="og:title" content="{{ $title }}">
<meta property="og:description" content="{{ $description }}">
<meta property="og:url" content="{{ .Permalink }}">
<meta property="og:site_name" content="{{ .Site.Title }}">
<meta property="og:locale" content="{{ .Site.LanguageCode | default "en_US" }}">

{{ if $image }}
<meta property="og:image" content="{{ $image }}">
<meta property="og:image:alt" content="{{ $imageAlt }}">
{{ end }}

{{/* Content type specific tags */}}
{{ if .IsPage }}
  {{ if eq .Section "blog" }}
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
    {{ with .Lastmod }}
      <meta property="article:modified_time" content="{{ .Format "2006-01-02T15:04:05Z07:00" }}">
    {{ end }}
    {{ with .Params.author }}
      <meta property="article:author" content="{{ . }}">
    {{ end }}
    {{ with .Params.category }}
      <meta property="article:section" content="{{ . }}">
    {{ end }}
    {{ range .Params.tags }}
      <meta property="article:tag" content="{{ . }}">
    {{ end }}
  {{ else }}
    <meta property="og:type" content="website">
  {{ end }}
{{ else }}
  <meta property="og:type" content="website">
{{ end }}

{{/* Additional SEO meta tags */}}
{{ with .Site.Params.author }}
  <meta name="author" content="{{ . }}">
{{ end }}

{{ if .IsPage }}
  <meta name="date" content="{{ .Date.Format "2006-01-02" }}">
  {{ with .Lastmod }}
    <meta name="last-modified" content="{{ .Format "2006-01-02" }}">
  {{ end }}
{{ end }}

{{/* Keywords if provided */}}
{{ with .Params.tags }}
  <meta name="keywords" content="{{ delimit . ", " }}">
{{ end }}

