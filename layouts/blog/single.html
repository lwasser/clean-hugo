{{ define "main" }}
<article>
  <!-- Hero Banner with Title Overlay -->
  <header class="blog-post__header"{{ if not .Params.image }}{{/* Get gradient colors based on category when no image */}}
    {{ $gradientColors := dict
      "Open Education" (dict "from" "#71B3B5" "to" "#2E6060")
      "Open Science" (dict "from" "#EDB88B" "to" "#D6A570")
      "Community" (dict "from" "#AC87A0" "to" "#8B6A8F")
      "Science Communication" (dict "from" "#71B3B5" "to" "#5A9A9C")
    }}
    {{ $postCategory := .Params.category }}
    {{ $defaultColors := dict "from" "#71B3B5" "to" "#2E6060" }}
    {{ $colors := $defaultColors }}
    {{ if $postCategory }}
      {{ $colors = index $gradientColors $postCategory | default $defaultColors }}
    {{ end }}
    style="background: linear-gradient(135deg, {{ $colors.from }} 0%, {{ $colors.to }} 100%);"
  {{ end }}>
    {{ $img := partial "get-image.html" (dict "image" .Params.image "fallbackAlt" .Title "page" .) }}
    {{ if $img.exists }}
    <img src="{{ $img.src }}" alt="{{ $img.alt }}" />
    {{ end }}

    <!-- Dark gradient overlay -->
    <div></div>

    <!-- Title and metadata overlaid on image -->
    <div>
      <h1>{{ .Title }}</h1>
      <p>{{ .Date.Format "Jan 2, 2006" }}{{ with .Params.category }} â€¢ {{ . }}{{ end }}</p>
    </div>

    <!-- Photo credit in bottom right -->
    {{ if $img.credit }}
    <div>
      {{ $img.credit }}
    </div>
    {{ end }}
  </header>

  <!-- Excerpt below banner -->
  {{ with .Params.excerpt }}
  <div class="blog-post__excerpt">
    <p>{{ . | markdownify }}</p>
  </div>
  {{ end }}

  <!-- Main content -->
  <div class="blog-post__content">
    {{ .Content }}

    {{ partial "learn-more.html" . }}
  </div>

  <!-- Image Gallery (if images exist) -->
  {{ $heroImage := .Params.image.src | default .Params.image }}
  {{ $images := .Resources.ByType "image" }}
  {{ $galleryImages := slice }}
  {{ range $images }}
    {{ if ne .Name $heroImage }}
      {{ $galleryImages = $galleryImages | append . }}
    {{ end }}
  {{ end }}
  {{ if gt (len $galleryImages) 0 }}
  <section class="gallery-images">
    <h2>Gallery</h2>
    <div class="gallery-masonry">
      {{ range $galleryImages }}
        {{ $filename := .Name | replaceRE "\\.[^.]+$" "" | replaceRE "-" " " | title }}
        <figure>
          <img src="{{ .RelPermalink }}" alt="{{ or .Title $filename }}" loading="lazy">
          <figcaption class="gallery-caption">{{ $filename }}</figcaption>
        </figure>
      {{ end }}
    </div>
  </section>
  {{ end }}

  <!-- Tags footer -->
  <footer class="blog-post__tags">
    {{ with .Params.tags }}Tags: {{ range $i, $t := . }}{{ if $i }}, {{ end }}<a href="{{ "/tags/" | relURL }}{{ urlize $t }}">{{ $t }}</a>{{ end }}{{ end }}
  </footer>

  <!-- Last modified date -->
  {{ partial "last-modified.html" . }}
</article>
{{ end }}

