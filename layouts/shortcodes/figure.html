{{- $src := .Get "src" -}}
{{- $alt := .Get "alt" | default "" -}}
{{- $caption := .Get "caption" -}}
{{- $link := .Get "link" | default $src -}}

{{- $base := replaceRE "\\.(jpg|jpeg|png|gif)$" "" $src -}}
{{- $webp := printf "%s.webp" $base -}}

<figure class="figure">
  <a href="{{ $link }}" class="figure__link">
    <picture class="figure__picture">
      <source srcset="{{ $webp }}" type="image/webp">
      <img src="{{ $src }}" alt="{{ $alt }}" class="figure__image">
    </picture>
  </a>
  {{- if $caption -}}
  <figcaption class="figure__caption">{{ $caption | markdownify }}</figcaption>
  {{- end -}}
</figure>

