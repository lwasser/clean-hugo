{{ define "main" }}
<article class="packages-page">

  {{/* Page Header */}}
  <header class="packages-page__header">
    <h1 class="packages-page__title">{{ .Title }}</h1>
    {{ with .Params.subtitle }}
    <p class="packages-page__subtitle">{{ . }}</p>
    {{ end }}
    {{ with .Content }}
    <div class="packages-page__intro">
      {{ . }}
    </div>
    {{ end }}
  </header>

  {{/* Package Metrics Bar */}}
  {{ if .Site.Data.packages }}
  {{ $totalPackages := len .Site.Data.packages }}
  {{ $activePackages := where .Site.Data.packages "active" true }}
  {{ $archivedPackages := where .Site.Data.packages "active" false }}
  {{ $jossPackages := where .Site.Data.packages "joss" "!=" nil }}

  <div class="metrics-bar">
    <div class="metrics-bar__item">
      <span class="metrics-bar__number">{{ $totalPackages }}</span>
      <span class="metrics-bar__label">Packages Accepted</span>
    </div>
    <div class="metrics-bar__item">
      <span class="metrics-bar__number">{{ len $jossPackages }}</span>
      <span class="metrics-bar__label">Published in JOSS</span>
    </div>
    <div class="metrics-bar__item">
      <span class="metrics-bar__number">{{ len $activePackages }}</span>
      <span class="metrics-bar__label">Currently Active</span>
    </div>
  </div>
  {{ end }}

  {{/* Filters and Search */}}
  <div class="packages-page__controls">
    {{ partial "packages/filters.html" . }}
  </div>

  {{/* Active Packages */}}
  {{ if .Site.Data.packages }}
  <section class="packages-page__section">
    <h2 class="packages-page__section-title">Active Packages</h2>
    {{ partial "packages/grid.html" (dict "packages" .Site.Data.packages "activeOnly" true) }}
  </section>

  {{/* Archived Packages */}}
  <section class="packages-page__section">
    <h2 class="packages-page__section-title">Archived Packages</h2>
    <p class="packages-page__section-description">
      Archived packages are packages that have successfully completed peer review
      but are no longer actively maintained.
    </p>
    {{ partial "packages/grid.html" (dict "packages" .Site.Data.packages "activeOnly" false "title" "") }}
  </section>
  {{ else }}
  <div class="packages-page__empty">
    <p>No package data found. Add packages to <code>data/packages.yml</code> to display them here.</p>
  </div>
  {{ end }}

</article>
{{ end }}
