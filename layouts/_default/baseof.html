<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode | default "en" }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>
  <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Summary | plainify | truncate 160 }}{{ end }}">

  {{/* Self-hosted fonts via @font-face (defined in main.scss) */}}

  {{/* Font Awesome (CDN) */}}
  {{ if .Site.Params.theme.enableFontAwesome | default true }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  {{ end }}

  {{/*
    Inject CSS variables from theme config (hugo.toml).
    NOTE: This must be in baseof.html (not SCSS) because:
    1. SCSS files cannot access Hugo template variables (.Site.Params)
    2. This inline <style> block loads BEFORE the compiled SCSS, allowing
       user-defined colors from hugo.toml to override the defaults in main.scss
    3. This is a standard Hugo pattern for theme customization
  */}}
  {{ $colors := .Site.Params.theme.colors | default dict }}
  <style>
    :root {
      {{ with $colors.primary }}--color-primary: {{ . }};{{ end }}
      {{ with $colors.primaryDark }}--color-primary-dark: {{ . }};{{ end }}
      {{ with $colors.primaryLight }}--color-primary-light: {{ . }};{{ end }}
      {{ with $colors.secondary }}--color-secondary: {{ . }};{{ end }}
      {{ with $colors.accent }}--color-accent: {{ . }};{{ end }}
      {{ with $colors.accentLight }}--color-accent-light: {{ . }};{{ end }}
      {{ with $colors.neutral }}--color-neutral: {{ . }};{{ end }}
      {{ with $colors.white }}--color-white: {{ . }};{{ end }}
      {{ with $colors.gray50 }}--color-gray-50: {{ . }};{{ end }}
      {{ with $colors.gray200 }}--color-gray-200: {{ . }};{{ end }}
      {{ with $colors.gray300 }}--color-gray-300: {{ . }};{{ end }}
      {{ with $colors.gray400 }}--color-gray-400: {{ . }};{{ end }}
      {{ with $colors.gray500 }}--color-gray-500: {{ . }};{{ end }}
      {{ with $colors.gray600 }}--color-gray-600: {{ . }};{{ end }}
      {{ with $colors.gray700 }}--color-gray-700: {{ . }};{{ end }}
      {{ with $colors.gray800 }}--color-gray-800: {{ . }};{{ end }}
      {{ with $colors.gray900 }}--color-gray-900: {{ . }};{{ end }}
      {{ with $colors.blogHighlight }}--color-blog-highlight: {{ . }};{{ end }}
      {{ with $colors.link }}--color-link: {{ . }};{{ end }}
      {{ with $colors.linkOnDark }}--color-link-on-dark: {{ . }};{{ end }}
      {{ with $colors.linkHover }}--color-link-hover: {{ . }};{{ end }}
      {{ with $colors.footerBg }}--color-footer-bg: {{ . }};{{ end }}
      {{ with $colors.featureCard }}--color-feature-card: {{ . }};{{ end }}

      /* Admonition colors */
      {{ with $colors.admonitionInfoBg }}--color-admonition-info-bg: {{ . }};{{ end }}
      {{ with $colors.admonitionInfoBorder }}--color-admonition-info-border: {{ . }};{{ end }}
      {{ with $colors.admonitionInfoText }}--color-admonition-info-text: {{ . }};{{ end }}
      {{ with $colors.admonitionInfoIcon }}--color-admonition-info-icon: {{ . }};{{ end }}

      {{ with $colors.admonitionSuccessBg }}--color-admonition-success-bg: {{ . }};{{ end }}
      {{ with $colors.admonitionSuccessBorder }}--color-admonition-success-border: {{ . }};{{ end }}
      {{ with $colors.admonitionSuccessText }}--color-admonition-success-text: {{ . }};{{ end }}
      {{ with $colors.admonitionSuccessIcon }}--color-admonition-success-icon: {{ . }};{{ end }}

      {{ with $colors.admonitionWarningBg }}--color-admonition-warning-bg: {{ . }};{{ end }}
      {{ with $colors.admonitionWarningBorder }}--color-admonition-warning-border: {{ . }};{{ end }}
      {{ with $colors.admonitionWarningText }}--color-admonition-warning-text: {{ . }};{{ end }}
      {{ with $colors.admonitionWarningIcon }}--color-admonition-warning-icon: {{ . }};{{ end }}

      {{ with $colors.admonitionDangerBg }}--color-admonition-danger-bg: {{ . }};{{ end }}
      {{ with $colors.admonitionDangerBorder }}--color-admonition-danger-border: {{ . }};{{ end }}
      {{ with $colors.admonitionDangerText }}--color-admonition-danger-text: {{ . }};{{ end }}
      {{ with $colors.admonitionDangerIcon }}--color-admonition-danger-icon: {{ . }};{{ end }}

      {{ with $colors.admonitionNoteBg }}--color-admonition-note-bg: {{ . }};{{ end }}
      {{ with $colors.admonitionNoteBorder }}--color-admonition-note-border: {{ . }};{{ end }}
      {{ with $colors.admonitionNoteText }}--color-admonition-note-text: {{ . }};{{ end }}
      {{ with $colors.admonitionNoteIcon }}--color-admonition-note-icon: {{ . }};{{ end }}
    }
  </style>

  {{/* Theme styles */}}
  {{ $styles := resources.Get "css/main.scss" | toCSS | postCSS | minify | fingerprint }}
  <link rel="stylesheet" href="{{ $styles.RelPermalink }}">

  {{/* GLightbox CSS for gallery feature */}}
  {{ if .Site.Params.theme.enableGallery | default true }}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css">
  {{ end }}

  {{/* Analytics */}}
  {{ with .Site.Params.analytics.google }}
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ . }}"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '{{ . }}');
    </script>
  {{ end }}
  {{ with .Site.Params.analytics.plausible }}
    <!-- Plausible Analytics -->
    <script defer data-domain="{{ . }}" src="https://plausible.io/js/script.js"></script>
  {{ end }}

  {{/* AlpineJS for interactive components (packages filtering, etc.) */}}
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

  {{/* Package filter component - loads immediately (no defer) to register listener before Alpine initializes */}}
  <script src="{{ "js/package-filter.js" | relURL }}"></script>
</head>
<body>
  <!-- Navigation -->
  <nav class="site-nav">
    <div class="site-nav__container">
      <a href="/" class="site-nav__brand">{{ .Site.Params.author | default .Site.Title }}</a>
      <button class="site-nav__toggle" aria-label="Toggle navigation" aria-expanded="false" aria-controls="site-nav-menu">
        <span class="site-nav__toggle-icon"></span>
        <span class="site-nav__toggle-icon"></span>
        <span class="site-nav__toggle-icon"></span>
      </button>
      <div class="site-nav__menu" id="site-nav-menu">
        {{ range .Site.Menus.main }}
          {{ if .HasChildren }}
            <div class="site-nav__dropdown">
              <a href="{{ .URL }}" class="site-nav__link site-nav__link--dropdown" aria-haspopup="true" aria-expanded="false">
                {{ .Name }}
                <i class="fas fa-chevron-down" aria-hidden="true"></i>
              </a>
              <ul class="site-nav__dropdown-menu">
                {{ range .Children }}
                  <li>
                    <a href="{{ .URL }}" class="site-nav__dropdown-link">{{ .Name }}</a>
                  </li>
                {{ end }}
              </ul>
            </div>
          {{ else }}
            <a href="{{ .URL }}" class="site-nav__link">{{ .Name }}</a>
          {{ end }}
        {{ end }}
      </div>
    </div>
  </nav>

  {{ block "main" . }}{{ end }}
  {{ partial "footer.html" . }}

  {{/* Navigation bar toggle JavaScript */}}
  <script src="{{ "js/navigation.js" | relURL }}" defer></script>

  {{ block "scripts" . }}{{ end }}
</body>
</html>

